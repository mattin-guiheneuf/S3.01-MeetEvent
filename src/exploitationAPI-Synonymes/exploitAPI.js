/**
 * 
 * Auteur: Duvignau Yannis
 * Date: 07/11/2023
 * Description: Fichier js d'exploitation de l'API utilisé pour récupérer les synonymes d'un mot saisi/
 *              Il reçoit le mot saisi sur le fichier "main.cpp"
 * 
 */



// Requis : Node.js et translate-google doivent être installés
// Pour installer Node.js : nvm install node
// Pour installer translate-google : npm install translate-google

const https = require('https'); // Module pour les requêtes HTTPS
const translate = require('translate-google'); // Module pour la traduction

const globalSynonymsList = []; // Liste pour stocker les synonymes d'un mot saisi

// Fonction pour obtenir des synonymes depuis une API externe
function getSynonymsFromWordsAPI(word, callback) {
  // Options de la requête à l'API
  const options = {
    method: 'GET',
    hostname: 'wordsapiv1.p.rapidapi.com',
    port: null,
    path: `/words/${word}/synonyms`,
    headers: {
      'X-RapidAPI-Key': 'votre_clé_API', // Remplacez par votre clé API
      'X-RapidAPI-Host': 'wordsapiv1.p.rapidapi.com',
    },
  };

  // Effectue la requête à l'API externe
  const req = https.request(options, function (res) {
    let data = '';

    res.on('data', function (chunk) {
      data += chunk;
    });

    res.on('end', function () {
      try {
        const response = JSON.parse(data);
        if (response.synonyms && response.synonyms.length > 0) {
          const synonyms = response.synonyms;
          globalSynonymsList.push(...synonyms);
          callback(null, synonyms); // Renvoie les synonymes via le callback
        } else {
          callback('Aucun synonyme trouvé pour le mot spécifié.');
        }
      } catch (error) {
        callback('Erreur lors de l\'analyse de la réponse de l\'API.');
      }
    });
  });

  // Gestion des erreurs lors de la requête
  req.on('error', function (error) {
    callback('Erreur lors de la requête à l\'API : ' + error.message);
  });

  req.end(); // Envoie la requête
}

// Exemple d'utilisation de la fonction pour obtenir les synonymes d'un mot spécifié
const wordToSearch = process.argv[2]; // Le premier argument passé en ligne de commande est le mot à rechercher

// Obtenir les synonymes du mot saisi
getSynonymsFromWordsAPI(wordToSearch, (error, globalSynonymsList) => {
  if (error) {
    console.error(error);
  } else {
    console.log('Synonymes pour', wordToSearch, ':');
    globalSynonymsList.forEach((synonym, index) => {
      console.log(`  ${index + 1}. ${synonym}`);
    });
  }
});

// Code en commentaire ci-dessous est utilisé pour la traduction de mots (non activé)
/*
translate(wordToSearch, { from: 'fr', to: 'en' })
  .then(englishTranslation => {
    // Obtenir les synonymes en anglais du mot traduit
    getSynonymsFromWordsAPI(englishTranslation, (error, englishSynonyms) => {
      if (error) {
        console.error(error);
      } else {
        // Traduire les synonymes en français
        const translationPromises = englishSynonyms.map(synonym => translate(synonym, { from: 'en', to: 'fr' }));

        Promise.all(translationPromises)
          .then(frenchTranslations => {
            console.log('\nSynonymes de', wordToSearch, ':');
            frenchTranslations.forEach((synonym, index) => {
              console.log(`          ${index + 1}. ${synonym}`);
            });
          })
          .catch(translationError => {
            console.error('Erreur de traduction des synonymes :', translationError);
          });
      }
    });
  })
  .catch(translationError => {
    console.error('Erreur de traduction :', translationError);
  });
*/
